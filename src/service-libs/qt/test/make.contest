KVDIR=/home/dabmo/projects/kvalobs/kvalobs

include $(KVDIR)/conf/make.$(OSTYPE)

DEPENDSFILE=make.depends

DIRLIST=$(wildcard $(DEPENDSFILE))

#dummy:
#	@echo "DIRLIST $(DIRLIST)"


#QT stuff
include $(QTDIR)/lib/libqt-mt.prl
MOC:=$(QTDIR)/bin/moc
QTLIB:=-L$(QTDIR)/lib -lqt-mt $(QMAKE_PRL_LIBS)
QTINCLUDE:=-I$(QTDIR)/include
QTDEFINES:=$(patsubst %,-D%,$(QMAKE_PRL_DEFINES))
ALL_Q_OBJECT_H:=$(shell grep -H -l Q_OBJECT *.h)	

#CORBA stuff
CORBA_INCLUDE=$(OMNIINCLUDE) 
CORBA_LIB=$(OMNILIB) -lomniORB4 -lomnithread 


#BOOST stuff
BOOST_INCLUDE=$(BOOSTINCLUDE)
BOOST_LIB=$(BOOSTLIB) -lboost_thread


#KVALOBS stuff
KVLIB:=-L$(KVDIR)/lib -lkvQt -lmiutil -lkvalobs -ldb -lcorbahelper \
	-ldnmithread -lcorba_skel 

KVINCLUDE:=-I$(KVDIR)/include/

Q_OBJECT_H:=$(shell grep -H -l Q_OBJECT *.h)	

CONOBJFILES:=kvQtConTest.o DataReceiver.o



#QT: some magic to generate moc targets.
CON_SRC:=$(CONOBJFILES:.o=.cc)
CONQT_Q_OBJECT_H:=$(filter $(CONOBJFILES:.o=.h), $(Q_OBJECT_H))
CONQT_OBJ:=$(CONOBJFILES) $(addprefix moc_, $(CONQT_Q_OBJECT_H:.h=.o))



INCLUDE:=$(KVINCLUDE) $(QTINCLUDE) $(BOOST_INCLUDE) $(CORBA_INCLUDE)

DEFINES=$(QTDEFINES)

CXXFLAGS += -g $(DEFINES) 


LIBS:= $(KVLIB)  $(BOOST_LIB)  $(CORBA_LIB) $(QTLIB) 


moc_%.cc: %.h
	$(MOC) $< -o $@


%.o: %.cc
	$(CXX) $(CXXFLAGS) $(INCLUDE) -c $< 


contest: $(CONQT_OBJ)
	$(CXX) $(CXXFLAGS) -o $@ $(CONQT_OBJ) $(LIBS)   		


depends:
	rm -f $(DEPENDSFILE)
	@echo '# Automatically-generated dependencies list:' > $(DEPENDSFILE)
	$(CXX) $(CXXFLAGS) $(INCLUDE) -M $(LIBSRC) >> $(DEPENDSFILE)



clean:
	rm -rf moc_*.*
	rm -rf *.o *~
	rm -f *.a


ifneq ($(wildcard $(DEPENDSFILE)), $(DEPENDSFILE))
$(shell touch $(DEPENDSFILE))	
endif

include $(DEPENDSFILE)




